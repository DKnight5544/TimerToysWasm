@page "/"
@page "/{id}"

@using TimerToysShared.Model
@using System.Collections.Generic
@inject HttpClient Http
@inject NavigationManager NavManager


@{

    <PageComponent @ref="pageComp"></PageComponent>

    for (int idx = 0; idx < 50; idx++)
    {
        int i2 = idx;
        <TimerToyComponent @ref=tta[i2] />
    }

    if (timers == null)
    {
        <h4><em>Still Loading . . .</em></h4>
    }
    else
    {
        if (string.IsNullOrWhiteSpace(id))
        {
            NavManager.NavigateTo(string.Format("/{0}", timers[0].PageKey));
        }

        pageComp.SetName(timers[0].PageName);

        int idx = 0;
        foreach (Timer t in timers)
        {
            tta[idx].SetTimer(t);
            idx++;
        }

    }

}


@code {

    [Parameter]
    public string id { get; set; }

    private Timer[] timers;


    private PageComponent pageComp = new PageComponent();
    private TimerToyComponent[] tta = new TimerToyComponent[100];

    protected override async Task OnInitializedAsync()
    {

        if (string.IsNullOrWhiteSpace(id))
        {
            timers = await Http.GetFromJsonAsync<Timer[]>("getnewpage");
        }
        else
        {
            //id = 0652EE5B-FA13-4585-A278-BB1F7D73F38A
            timers = await Http.GetFromJsonAsync<Timer[]>(string.Format("getallbypage/{0}", id));
        }

    }


}
